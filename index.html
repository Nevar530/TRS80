<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TRS:80//Technical Readout System:80</title>
  <link rel="stylesheet" href="./style.css?v=6">

  <!-- SVG favicon (crisp on any DPI) -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
    <rect x="6" y="10" width="52" height="40" rx="6" fill="%23121826" />
    <path d="M18 22l12 10-12 10" fill="none" stroke="%23ffd06e" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M36 42h12" fill="none" stroke="%23ffd06e" stroke-width="4" stroke-linecap="round"/>
  </svg>'>

  <!-- PNG fallback (optional) -->
  <link rel="icon" type="image/png" sizes="32x32"
        href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAA...'>

  <link rel="apple-touch-icon" sizes="180x180"
        href='data:image/svg+xml;utf8,
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 180 180">
    <rect width="180" height="180" rx="36" fill="%23121826"/>
    <path d="M45 60l45 37-45 37" fill="none" stroke="%23ffd06e" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M105 134h30" fill="none" stroke="%23ffd06e" stroke-width="10" stroke-linecap="round"/>
  </svg>'>

  <meta name="theme-color" content="#121826">
</head>
<body>
  <noscript><div class="noscript">This app requires JavaScript enabled.</div></noscript>

  <div class="app">
    <!-- Topbar -->
    <header class="ui-topbar" role="banner">
      <div class="topbar-left">
        <button id="btn-side-toggle" class="icon-btn" aria-label="Open mech list" aria-expanded="false" aria-controls="mech-sidebar" style="margin-right:6px;">‚ò∞</button>
        <div class="brand">
          <span class="glyph" aria-hidden="true" style="display:inline-flex;align-items:center">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="3" width="20" height="16" rx="2.5" fill="rgba(255,255,255,0.02)" stroke="currentColor" opacity="0.9"/>
              <path d="M7 8l4 4-4 4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13 16h4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="brand-text">[TRS:80]</span>
        </div>
      </div>

      <div class="topbar-right actions actions--top">
        <button id="btn-lance" class="btn ghost" title="Show Lance" aria-controls="lance-dock">Lance</button>
        <button id="btn-owned" class="btn ghost" title="Owned Chassis" aria-controls="owned-dock">Owned</button>

        <button id="btn-import" class="btn icon ghost" title="Import session JSON" aria-label="Import">‚¨á</button>
        <button id="btn-export" class="btn icon ghost" title="Export session JSON" aria-label="Export">‚¨Ü</button>

        <div class="divider" aria-hidden="true"></div>

        <button id="btn-load-manifest" class="btn icon" title="Load manifest.json" aria-label="Load Manifest">üìÑ</button>
        <button id="btn-settings" class="btn icon ghost" title="Settings (About & Attribution)" aria-label="Settings">‚öô</button>
      </div>
    </header>

    <!-- App layout -->
    <main class="layout">
      <!-- Sidebar mount (module owns list+filters+drawer) -->
      <aside class="col-left" id="mech-sidebar" aria-label="Mech List"></aside>
      <div id="sidebar-scrim" hidden></div>

      <!-- Main column -->
      <section class="col-right">
        <div id="lance-dock"></div>
        <div id="owned-dock"></div>

        <!-- Swappable header card -->
        <div class="card" id="top-swapper">
          <div class="card-h">
            <div class="card-title">Current Selection</div>
            <div class="tabs" role="tablist" aria-label="Top view switch">
              <button class="tab is-active" role="tab" aria-selected="true"  data-swap="pane-overview">Overview</button>
              <button class="tab"           role="tab" aria-selected="false" data-swap="pane-techreadout">Tech Readout</button>
              <button class="tab"           role="tab" aria-selected="false" data-swap="pane-gator">GATOR</button>
              <button class="tab"           role="tab" aria-selected="false" data-swap="tab-weapons">Weapons</button>
            </div>
          </div>

          <div class="card-c">
            <!-- OVERVIEW (kept simple, chassis updates these fields) -->
            <section id="pane-overview" class="swap-pane is-active" role="tabpanel" aria-labelledby="Overview">
              <div class="overview-flex">
                <div class="vheat">
                  <div class="vheat-bar" id="vheat" role="meter" aria-valuemin="0" aria-valuemax="50" aria-valuenow="0">
                    <div class="vheat-fill" id="vheat-fill" style="height:0%"></div>
                  </div>
                  <div class="vheat-legend mono small">
                    <span id="heat-now">0</span>/<span id="heat-cap">‚Äî</span>
                  </div>
                </div>

                <div class="overview-grid">
                  <div><label class="dim small">Mech</label>         <div id="ov-mech"    class="mono">‚Äî</div></div>
                  <div><label class="dim small">Variant</label>      <div id="ov-variant" class="mono">‚Äî</div></div>
                  <div><label class="dim small">Tonnage</label>      <div id="ov-tons"    class="mono">‚Äî</div></div>
                  <div><label class="dim small">Pilot</label>        <div id="ov-pilot"   class="mono">‚Äî</div></div>
                  <div><label class="dim small">Gunnery / Piloting</label>
                       <div class="mono"><span id="ov-gun">‚Äî</span> / <span id="ov-pil">‚Äî</span></div></div>
                  <div><label class="dim small">Movement</label>     <div id="ov-move"    class="mono">‚Äî</div></div>
                  <div style="grid-column:1 / -1;">
                    <label class="dim small">Key Weapons</label>
                    <div class="mono small dim" id="ov-weps">‚Äî</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- Tech Readout island mount -->
            <section id="pane-techreadout" class="swap-pane" role="tabpanel" aria-labelledby="Tech Readout">
              <div id="tech-root"></div>
            </section>

            <!-- GATOR island mount -->
            <section id="pane-gator" class="swap-pane" role="tabpanel" aria-labelledby="GATOR">
              <div id="gator-root"></div>
            </section>

            <!-- Weapons island mount -->
            <section id="tab-weapons" class="swap-pane" role="tabpanel" aria-labelledby="Weapons">
              <div id="weapons-root"></div>
            </section>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="app-footer" role="contentinfo">
      <span>BattleTech & ‚ÄôMech ¬© Topps / Catalyst ‚Ä¢ App code ¬© 2025 MIT ‚Ä¢ Data: MegaMek (CC BY-NC-SA 4.0)</span>
      <button id="footer-about" class="linklike">About</button>
    </footer>
  </div>

  <!-- Settings / About Modal -->
  <div id="settings-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="about-title" hidden>
    <div class="modal-card" role="document">
      <header class="modal-h">
        <h2 id="about-title">About & Attribution</h2>
        <button id="modal-close" class="icon-btn" aria-label="Close">‚úï</button>
      </header>
      <div class="modal-c">
        <p class="small">
          Data adapted from <strong>‚ÄúMegaMek Data (C) 2025 by The MegaMek Team‚Äù</strong>,
          <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a>.<br><br>
          Mech line art is fetched from <a href="https://www.sarna.net/wiki/Main_Page" target="_blank" rel="noopener">Sarna</a>.
          This app does not host images; credits shown in-app when available.
        </p>
        <hr class="modal-divider" />
        <div class="small">
          <div><strong>Source:</strong> MegaMek <code>mm-data</code> (meks)</div>
          <div><strong>License:</strong> CC BY-NC-SA 4.0</div>
          <div id="build-line"><strong>Build:</strong> <span data-build-ts></span></div>
        </div>
      </div>
      <footer class="modal-f">
        <button id="modal-ok" class="btn sm">OK</button>
      </footer>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" hidden></div>

  <!-- Boot overlay -->
  <div id="troBoot" class="tro-boot" aria-hidden="false">
    <div class="tro-boot__vignette"></div>
    <div class="tro-boot__scan"></div>
    <div class="tro-boot__grid"></div>
    <div class="tro-boot__watermark" aria-hidden="true"></div>
    <section class="tro-boot__panel" role="dialog" aria-label="TRS:80 Technical Readout Loader">
      <header class="tro-boot__hdr">
        <h1 class="tro-boot__title">TRS:80//Technical Readout System:80 LOADER</h1>
        <div class="tro-boot__meta">CAT#: TRS-80-TROLDR v2.0 ¬∑ TRO-PREFACE ¬∑ PAGE 00</div>
      </header>
      <pre id="troLog" class="tro-boot__log" aria-live="polite"></pre>
      <div class="tro-boot__progress" aria-hidden="true"><div id="troBar" class="tro-boot__bar"></div></div>
      <div id="troHint" class="tro-boot__hint">PRESS <kbd>ENTER</kbd> TO OPEN TRO ‚ñå ‚Ä¢ AUTO WHEN READY</div>
    </section>
  </div>

  <!-- ES module entry -->
  <script type="module" src="./script.js"></script>
</body>
</html>
